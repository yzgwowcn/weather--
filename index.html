<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的私人天气站</title>
    
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
    <script src="https://api.windy.com/assets/map-forecast/libBoot.js"></script>
    
    <style>
        /* 页面基础样式 */
        body, html { margin: 0; padding: 0; height: 100%; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        
        /* 地图容器全屏 */
        #windy { width: 100%; height: 100%; z-index: 1; }
        
        /* 悬浮搜索框样式 */
        .search-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000; /* 保证在地图上方 */
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 15px;
            border-radius: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            gap: 10px;
            width: 90%;
            max-width: 400px;
        }
        
        input {
            border: none;
            outline: none;
            flex-grow: 1;
            font-size: 16px;
            background: transparent;
        }
        
        button {
            background-color: #ff5b5b; /* Windy 风格红 */
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
        }
        
        button:hover { background-color: #e04a4a; }
        
        /* 搜索状态提示 */
        #status-msg {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            display: none; /* 默认隐藏 */
        }
    </style>
</head>
<body>

    <div class="search-container">
        <input type="text" id="city-input" placeholder="输入地点 (如: 赛里木湖, 新疆)">
        <button onclick="handleSearch()">查询</button>
    </div>
    
    <div id="status-msg">正在搜索...</div>

    <div id="windy"></div>

    <script>
        // =================配置区域=================
        const WINDY_API_KEY = 'FFpdvdMfnPldA3dh7nRJCv6kc4uE9FWZ'; 
        // ==========================================

        let windyMap = null; // 全局地图对象
        let currentMarker = null; // 当前标记

        // 初始化 Windy 地图
        const options = {
            key: WINDY_API_KEY,
            lat: 34.0, // 初始纬度 (中国大概中心)
            lon: 108.0, // 初始经度
            zoom: 4,
            verbose: false, // 是否在控制台输出日志
        };

        // 启动 Windy
        windyInit(options, windyAPI => {
            const { map } = windyAPI;
            windyMap = map;
            
            // 这里可以设置默认图层，比如 'wind' (风), 'rain' (雨), 'temp' (温度)
            // windyAPI.store.set('overlay', 'wind'); 
        });

        // 搜索处理函数
        async function handleSearch() {
            const query = document.getElementById('city-input').value;
            const statusDiv = document.getElementById('status-msg');
            
            if (!query) return;

            // 显示加载提示
            statusDiv.style.display = 'block';
            statusDiv.innerText = '正在飞往 ' + query + '...';

            try {
                // 调用 OpenStreetMap 的 Nominatim 接口进行地理编码
                // 加上 limit=1 只取最匹配的一个结果
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=1`);
                const data = await response.json();

                if (data && data.length > 0) {
                    const lat = parseFloat(data[0].lat);
                    const lon = parseFloat(data[0].lon);

                    // 1. 移动地图
                    if (windyMap) {
                        // setView(坐标, 缩放层级)
                        windyMap.setView([lat, lon], 10); 
                        
                        // 2. 清除旧标记并添加新标记
                        if (currentMarker) windyMap.removeLayer(currentMarker);
                        
                        // 创建一个小标记指向该地点
                        currentMarker = L.marker([lat, lon]).addTo(windyMap)
                            .bindPopup(`<b>${query}</b><br>这里的天气情况`)
                            .openPopup();
                    }
                    statusDiv.style.display = 'none';
                } else {
                    statusDiv.innerText = '未找到该地点，请尝试更详细的名称';
                    setTimeout(() => { statusDiv.style.display = 'none'; }, 2000);
                }
            } catch (error) {
                console.error(error);
                statusDiv.innerText = '搜索服务出错，请稍后再试';
            }
        }

        // 允许回车键搜索
        document.getElementById('city-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') handleSearch();
        });
    </script>
</body>

</html>
